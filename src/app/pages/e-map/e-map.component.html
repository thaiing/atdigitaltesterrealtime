<div class="page-container">
  <div class="page-header">
    <h1>E-Map</h1>
    <div class="legend">
      <div class="legend-item">
        <span class="legend-dot connected"></span>
        <span>Connected</span>
      </div>
      <div class="legend-item">
        <span class="legend-dot alert"></span>
        <span>Alert</span>
      </div>
      <div class="legend-item">
        <span class="legend-dot disconnected"></span>
        <span>Disconnected</span>
      </div>
    </div>
  </div>

  <div class="map-container">
    <!-- Map Canvas -->
    <mat-card class="map-card">
      <div class="map-canvas">
        <img src="assets/images/emap/schematic.jpg" alt="Substation Schematic" class="schematic-bg">

        <!-- Device markers -->
        <div *ngFor="let device of devices" class="device-marker-container"
          [style.left]="getDevicePosition(device).left" [style.top]="getDevicePosition(device).top"
          (click)="selectDevice(device)" [matTooltip]="device.name">
          <!-- FOV Cone (for cameras) -->
          <img *ngIf="device.type === 'camera'" src="assets/images/emap/camera-fov.jpg" class="fov-cone"
            [style.transform]="'rotate(' + (device.rotation || 0) + 'deg)'"
            [class.selected]="selectedDevice?.id === device.id">

          <!-- Device Icon -->
          <div class="marker-icon" [class]="getStatusClass(device.status)">
            <img *ngIf="device.type === 'camera'" src="assets/images/emap/camera-icon.jpg" class="camera-icon-img">
            <mat-icon *ngIf="device.type !== 'camera'">{{ getDeviceIcon(device.type) }}</mat-icon>
          </div>

          <!-- Temperature Label -->
          <span class="temp-label" *ngIf="device.temperature">
            {{ device.temperature | number:'1.0-0' }}°
          </span>
        </div>
      </div>
    </mat-card>

    <!-- Device Details Panel -->
    <mat-card class="details-panel" *ngIf="selectedDevice">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>{{ getDeviceIcon(selectedDevice.type) }}</mat-icon>
          {{ selectedDevice.name }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="detail-row">
          <span class="label">Type</span>
          <span class="value">{{ selectedDevice.type === 'camera' ? 'Thermal Camera' : 'Temperature Sensor' }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Status</span>
          <span class="value status-badge" [class]="getStatusClass(selectedDevice.status)">
            {{ selectedDevice.status | titlecase }}
          </span>
        </div>
        <div class="detail-row" *ngIf="selectedDevice.temperature">
          <span class="label">Temperature</span>
          <span class="value temp">{{ selectedDevice.temperature | number:'1.1-1' }}°C</span>
        </div>
        <div class="detail-row">
          <span class="label">Position</span>
          <span class="value">X: {{ selectedDevice.position.x }}, Y: {{ selectedDevice.position.y }}</span>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <button mat-stroked-button color="primary">
          <mat-icon>settings</mat-icon>
          Configure
        </button>
        <button mat-stroked-button *ngIf="selectedDevice.type === 'camera'">
          <mat-icon>videocam</mat-icon>
          View Stream
        </button>
      </mat-card-actions>
    </mat-card>

    <!-- Device List -->
    <mat-card class="device-list-card">
      <mat-card-header>
        <mat-card-title>Devices</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="device-list">
          <div *ngFor="let device of devices" class="device-list-item"
            [class.selected]="selectedDevice?.id === device.id" (click)="selectDevice(device)">
            <mat-icon [class]="getStatusClass(device.status)">{{ getDeviceIcon(device.type) }}</mat-icon>
            <div class="device-info">
              <span class="device-name">{{ device.name }}</span>
              <span class="device-temp" *ngIf="device.temperature">{{ device.temperature | number:'1.1-1' }}°C</span>
            </div>
            <span class="status-dot" [class]="getStatusClass(device.status)"></span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>